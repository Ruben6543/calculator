---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { ARTICLES, CATEGORIES, type Article } from '../data/articles';

// Filter published articles, sort by date descending, limit to 12
const publishedArticles = ARTICLES
	.filter((article) => article.status === 'published')
	.sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime())
	.slice(0, 12);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			.articles-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 2rem 1rem;
			}

			.page-title {
				margin-bottom: 2rem;
				text-align: center;
			}

			.filter-section {
				margin-bottom: 2rem;
				display: flex;
				flex-wrap: wrap;
				gap: 0.75rem;
				justify-content: center;
				align-items: center;
			}

			.filter-label {
				font-weight: 700;
				color: rgb(var(--black));
			}

			.filter-buttons {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
			}

			.filter-button {
				padding: 0.5rem 1rem;
				border: 2px solid rgb(var(--gray-light));
				background: white;
				color: rgb(var(--gray-dark));
				border-radius: 8px;
				cursor: pointer;
				font-size: 0.9rem;
				transition: all 0.2s ease;
				font-family: inherit;
			}

			.filter-button:hover {
				border-color: var(--accent);
				color: var(--accent);
			}

			.filter-button.active {
				background: var(--accent);
				color: white;
				border-color: var(--accent);
			}

			.articles-grid {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 2rem;
				margin-top: 2rem;
			}

			.article-card {
				background: white;
				border-radius: 12px;
				padding: 1.5rem;
				box-shadow: 0 2px 8px rgba(var(--gray), 15%);
				transition: all 0.3s ease;
				display: flex;
				flex-direction: column;
				height: 100%;
				text-decoration: none;
				color: inherit;
			}

			.article-card:hover {
				box-shadow: var(--box-shadow);
				transform: translateY(-4px);
			}

			.article-category {
				display: inline-block;
				padding: 0.25rem 0.75rem;
				background: rgb(var(--gray-light));
				color: rgb(var(--gray-dark));
				border-radius: 20px;
				font-size: 0.75rem;
				font-weight: 700;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				margin-bottom: 1rem;
			}

			.article-title {
				margin: 0 0 0.75rem 0;
				color: rgb(var(--black));
				font-size: 1.25rem;
				line-height: 1.3;
			}

			.article-excerpt {
				color: rgb(var(--gray));
				font-size: 0.95rem;
				line-height: 1.6;
				margin-bottom: 1rem;
				flex-grow: 1;
			}

			.article-meta {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding-top: 1rem;
				border-top: 1px solid rgb(var(--gray-light));
				font-size: 0.85rem;
				color: rgb(var(--gray));
			}

			.article-author {
				font-weight: 600;
			}

			.article-date {
				color: rgb(var(--gray));
			}

			.no-articles {
				text-align: center;
				padding: 3rem;
				color: rgb(var(--gray));
				font-size: 1.1rem;
			}

			/* Responsive: 2 columns on tablets */
			@media (max-width: 960px) {
				.articles-grid {
					grid-template-columns: repeat(2, 1fr);
					gap: 1.5rem;
				}

				.articles-container {
					padding: 1.5rem 1rem;
				}
			}

			/* Responsive: 1 column on mobile */
			@media (max-width: 640px) {
				.articles-grid {
					grid-template-columns: 1fr;
					gap: 1.5rem;
				}

				.filter-section {
					flex-direction: column;
					align-items: flex-start;
				}

				.filter-buttons {
					width: 100%;
				}

				.filter-button {
					flex: 1;
					min-width: calc(50% - 0.25rem);
				}

				.articles-container {
					padding: 1rem;
				}

				.page-title {
					font-size: 2rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main class="articles-container">
			<h1 class="page-title">{SITE_TITLE}</h1>

			<section class="filter-section" aria-label="Filter articles by category">
				<span class="filter-label">Filter by category:</span>
				<div class="filter-buttons">
					<button
						class="filter-button active"
						data-category="all"
						aria-pressed="true"
					>
						All
					</button>
					{
						CATEGORIES.map((category) => (
							<button
								class="filter-button"
								data-category={category.toLowerCase()}
								aria-pressed="false"
							>
								{category}
							</button>
						))
					}
				</div>
			</section>

			<div class="articles-grid" id="articles-grid">
				{
					publishedArticles.map((article) => (
						<a
							href={`/article/${article.id}`}
							class="article-card"
							data-category={article.category.toLowerCase()}
						>
							<span class="article-category">{article.category}</span>
							<h2 class="article-title">{article.title}</h2>
							<p class="article-excerpt">{article.excerpt}</p>
							<div class="article-meta">
								<span class="article-author">{article.author}</span>
								<time class="article-date">
									<FormattedDate date={article.pubDate} />
								</time>
							</div>
						</a>
					))
				}
			</div>

			<div class="no-articles" id="no-articles" style="display: none;">
				No articles found in this category.
			</div>
		</main>
		<Footer />

		<script>
			// Client-side filtering functionality
			(function () {
				const filterButtons = document.querySelectorAll('.filter-button');
				const articleCards = document.querySelectorAll('.article-card');
				const noArticlesMessage = document.getElementById('no-articles');
				const articlesGrid = document.getElementById('articles-grid');

				function filterArticles(category) {
					let visibleCount = 0;

					articleCards.forEach((card) => {
						const cardCategory = card.getAttribute('data-category');
						if (category === 'all' || cardCategory === category) {
							card.style.display = 'flex';
							visibleCount++;
						} else {
							card.style.display = 'none';
						}
					});

					// Show/hide no articles message
					if (visibleCount === 0) {
						noArticlesMessage.style.display = 'block';
						articlesGrid.style.display = 'none';
					} else {
						noArticlesMessage.style.display = 'none';
						articlesGrid.style.display = 'grid';
					}
				}

				filterButtons.forEach((button) => {
					button.addEventListener('click', () => {
						const category = button.getAttribute('data-category') || 'all';

						// Update active state
						filterButtons.forEach((btn) => {
							btn.classList.remove('active');
							btn.setAttribute('aria-pressed', 'false');
						});
						button.classList.add('active');
						button.setAttribute('aria-pressed', 'true');

						// Filter articles
						filterArticles(category);
					});
				});
			})();
		</script>
	</body>
</html>
